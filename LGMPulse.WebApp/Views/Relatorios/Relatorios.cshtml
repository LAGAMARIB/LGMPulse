@using LGMDomains.Common.Helpers;
@{
    Layout = "_Layout";
    ViewBag.Title = "PULSE Relatórios";
    var today = DateTimeHelper.Now().Date;
    int month = today.Month;
    int year = today.Year;
}

@section style {
    <style>
        #topBar {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: .75rem 1rem;
            background: var(--grafite-2);
            color: var(--branco-neve);
            font-size: 18px;
        }

        .menu-toggle {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.4rem;
            cursor: pointer;
        }

        #relatoriosMenu {
            position: absolute;
            top: 5.2rem;
            left: 1rem;
            background: var(--grafite-3);
            padding: .5rem;
            border-radius: 6px;
            box-shadow: 0 8px 20px rgba(0,0,0,.35);
            transition: opacity .2s ease, transform .2s ease;
        }

            #relatoriosMenu.collapsed {
                opacity: 0;
                pointer-events: none;
                transform: translateY(-10px);
            }

        .relat-option {
            display: block;
            width: 100%;
            background: none;
            border: none;
            color: var(--branco-neve);
            padding: .5rem .75rem;
            text-align: left;
            cursor: pointer;
            font-size: 18px;
        }

            .relat-option:hover {
                background: rgba(255,255,255,.08);
            }
    </style>
}

<div id="topBar">
    <button id="btnToggleRelatorios" class="menu-toggle" aria-label="Abrir menu de relatórios">
        <i class="fas fa-bars"></i>
    </button>
    <span class="title">Relatórios</span>
</div>

<div id="relatoriosMenu" class="collapsed">
    <button class="relat-option" data-rel="grupos">Movimento por Grupos</button>
    <button class="relat-option" data-rel="evolucao">Evolução Mensal</button>
    <button class="relat-option" data-rel="mapafinanceiro">Mapa Financeiro</button>
</div>

<div id="relatoriosFrame">

</div>

@section script {
    <script>
        let month = parseInt("@month", 1);
        let year = parseInt("@year", 2025);

        function carregarRelatorio(nome) {
            $.get(`/relatorios/${nome}/${year}/${month}`, function (resp) {
                if (resp) {
                    $('#relatoriosFrame').html(resp);
                    localStorage.setItem('ultimoRelatorio', nome);
                }
            });
        }

        $('#btnToggleRelatorios').on('click', function () {
            $('#relatoriosMenu').toggleClass('collapsed');
        });

        $('.relat-option').on('click', function () {
            const rel = $(this).data('rel');
            carregarRelatorio(rel);
            $('#relatoriosMenu').addClass('collapsed');
        });

        $(document).ready(function () {
            const ultimo = localStorage.getItem('ultimoRelatorio');

            if (ultimo) {
                carregarRelatorio(ultimo);
            }

            DisableIcon(3);
        });
    </script>
}