@using LGMPulse.WebApp.Models
@model NovoLancamentoModel
@{
    ViewBag.Title = "Nova Despesa";
}

@section style {
    <style>
        body > div.mainContainer > div.MainHeader  {
           background-color: var(--pulse-red);
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 18px;
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 150px); /* Para o mobile com header */
        }

        .category-item {
            background: #ffffff;
            border-radius: 16px;
            padding: 16px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.15s ease, box-shadow 0.15s ease;
            cursor: pointer;
        }

            .category-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 4px 14px rgba(0,0,0,0.14);
            }

            .category-item img {
                width: 52px;
                height: 52px;
                margin-bottom: 12px;
            }

            .category-item span {
                font-size: 1.1rem;
                font-weight: 600;
                color: #333;
            }

        .period-warning {
            margin: 16px;
            padding: 14px 16px;
            border-radius: 14px;
            background: var(--badge-back-color);
            color: var(--badge-text-color);
            font-size: 0.95rem;
            font-weight: 500;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.12);
        }

            .period-warning strong {
                display: block;
                font-weight: 700;
                text-align: center;
                margin-top: 4px;
            }

        /* Melhorar o toque no mobile */
        @@media (hover: none) {
            .category-item:active
            {
                transform: scale(0.96);
            }
        }
    </style>
}

@if (!Model.IsMesAtual)
{
    <div class="period-warning">
        Você está lançando uma despesa em
        <strong>@Model.MesReferencia</strong>
    </div>
}

<div class="category-grid">
    @foreach (var grupo in Model.Grupos)
    {
        <div class="category-item" data-grupo="@grupo.ID">
            <img src="@grupo.ImagePath" alt="@grupo.Descricao" />
            <span>@grupo.Descricao</span>
        </div>
    }
</div>

@section script {
    <script>
        $(document).ready(function () {
            $(".category-item").on("click", function () {

                window.parent.pushOverlay("/Lancamento/DigitarValor");

                const idGrupo = $(this).data('grupo');
                const descGrupo = $(this).find("span").text();
                const ano = parseInt('@Model.Year', 0);
                const mes = parseInt('@Model.Month', 0);
                const DESPESA = 1;
                const URL = `/Lancamento/DigitarValor/${DESPESA}/${idGrupo}/${descGrupo}/${ano}/${mes}`;
                $(window.parent.document).find("#overlayFrame").each(function () {
                    $(this)
                        .attr("src", URL)
                        .show();
                });

                // mostrar o botão voltar
                $(window.parent.document)
                    .find("#backOverlayButton")
                    .show();

                // esconder tela inicial
                $(window.parent.document)
                    .find("#overlayHome")
                    .hide();
            });
        });

    </script>
}